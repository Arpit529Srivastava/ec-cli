name: ec replace
synopsis: Replace image references in the given source
description: |-
  Replace image references in the given source

  Given a source, process its contents to identify Tekton bundle
  image references and replace them with an updated version.

  For any image reference matching the catalog-repo-base, Tekton
  Hub is consulted to determine the latest version of the task,
  and its latest image reference. The original image reference is
  then replaced with its latest version.

  If one or more image parameters are provided, they will also be
  used to replace image references matching the same OCI repository.
  For example, the image reference "example.com/repo:1.2" would
  replace the image reference "example.com/repo:1.1". The provided
  image reference can inlude a tag, a digest, or both. If a digest
  is not provided, ec will query the repository for this value.

  The following source types are supported:

  file: simply a file accessible by the local file system. It
    can be optionally prefixed with the string file://

  git repo: a reference to a git repository. By default, the
    branch named main is used. Add the suffix #<branch> to
    specify a different branch. This source type is defined by
    any one of the prefixes https:// http:// git://
usage: ec replace [flags]
options:
- name: catalog-hub-api
  default_value: https://api.hub.tekton.dev
  usage: URL for the Tekton Hub API
- name: catalog-name
  default_value: tekton
  usage: Name of the catalog in the Tekton Hub
- name: catalog-repo-base
  default_value: gcr.io/tekton-releases/catalog/upstream/
  usage: |
    Base of the OCI repository where images from the Tekton Hub are found. The full image reference is created as <base><name>:<version>
- name: help
  shorthand: h
  default_value: "false"
  usage: help for replace
- name: output
  shorthand: o
  usage: |
    Write changes to a file. Use empty string for stdout, default behavior
- name: overwrite
  default_value: "false"
  usage: Overwrite source file with changes
- name: source
  shorthand: s
  usage: |
    REQUIRED - An existing YAML file or a git repository reference
inherited_options:
- name: debug
  default_value: "false"
  usage: |
    same as verbose but also show function names and line numbers
- name: quiet
  default_value: "false"
  usage: less verbose output
- name: verbose
  default_value: "false"
  usage: more verbose output
example: |2-
    ec replace --source <source path> [<image uri> ...]

  Display a modified version of the source file where
  all occurences of bundle references from the main Tekton
  catalog are replace with the corresponding latest version:

    ec replace --source resource.yaml

  Process all the yaml files in the main branch of a git repository:

    ec replace --source https://git.example.com/org/repo

  Specify an alternative branch:

    ec replace --source https://git.example.com/org/repo#my-branch

  In addition to the Tekton catalog, also replace occurences of
  the provided image:

    ec replace --source resource.yaml <IMAGE>

  In addition to the Tekton catalog, also replace occurences of
  the provided images:

    ec replace --source resource.yaml <IMAGE> <IMAGE>
see_also:
- ec - Tool to enforce enterprise contracts
